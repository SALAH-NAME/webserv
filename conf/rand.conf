# webserv.conf - Complete configuration file
client_max_body_size 102400;
connection_timeout 60;
cgi_timeout 60;
index index.html index.htm;
error_log /logs/error.log;
access_log /logs/access.log;
error_page 400 /error/400.html;
error_page 401 /error/401.html;
error_page 403 /error/403.html;
error_page 404 /error/404.html;
error_page 500 501 /error/50x.html;

server {
    listen 8080;
    host 127.0.0.1;
    server_name example.com www.example.com;
    error_page 404 /custom_errors/404.html;
    error_page 500 502 503 504 /custom_errors/50x.html;
    client_max_body_size 20M;
    
    location / {
        root /var/www/html;
        index index.html index.htm;
        allowed_methods GET POST DELETE;
        autoindex off;
    }
    
    location /browse {
        root /var/www/public;
        index index.html;
        allowed_methods GET;
        autoindex on;
    }
    
    location /redirect {
        return 301 /new-page;
    }
    
    location /upload {
        root /var/www/uploads;
        allowed_methods POST;
        client_max_body_size 50M;
        upload_store /tmp/uploads;
    }
    
    location ~ .php {
        root /var/www/html;
        allowed_methods GET POST;
        cgi_pass /usr/bin/php-cgi;
				cgi_timeout 120;
    }
    
    location /kapouet {
        root /tmp/www;
        index index.html;
        allowed_methods GET POST;
        autoindex off;
    }
}

server {
    listen 8080;
    host 127.0.0.1;
    server_name test.com;
    error_page 404 /custom_errors/test_404.html;
    location / {
        root /var/www/test;
        index index.html;
        allowed_methods GET POST DELETE;
        autoindex off;
    }
}

server {
    listen 9090;
    host 127.0.0.1;
    server_name example.com;
    
    location / {
        root /var/www/other;
        index index.html;
        allowed_methods GET POST DELETE;
        autoindex off;
    }
}

server {
    listen 8080;
    host 192.168.1.10;
    server_name another.example.com;
    
    location / {
        root /var/www/another;
        index index.html;
        allowed_methods GET POST;
        autoindex off;
    }
}

server {
    listen 7070;
    host 127.0.0.1;
    server_name cgi.example.com;
    
    location ~ .php {
        root /var/www/cgi;
        allowed_methods GET POST;
        cgi_pass /usr/bin/php-cgi;
    }
    
    location ~ .py {
        root /var/www/cgi;
        allowed_methods GET POST;
        cgi_pass /usr/bin/python3;
    }
    
    location ~ .pl {
        root /var/www/cgi;
        allowed_methods GET POST;
        cgi_pass /usr/bin/perl;
    }
}

server {
    listen 6060;
    host 127.0.0.1;
    server_name session.example.com;
    
    session_enable on;
    session_name WEBSERV_SESSION;
    session_path /tmp/sessions;
    session_timeout 1800;
    
    location / {
        root /var/www/session;
        index index.html;
        allowed_methods GET POST;
        autoindex off;
    }
    
    location /login {
        root /var/www/session;
        allowed_methods GET POST;
    }
				session_timeout 3600;
}



#####################################################################
# CONFIGURATION FIELD REFERENCE TABLE
#####################################################################
# Directive               | Required? | Default    | Possible Values
#-------------------------|-----------|------------------------------
# listen                  | Yes       | N/A        | 1-65535
# host                    | Yes       | N/A        | IP address (IPv4)
# server_name             | No        | ""         | Domain names
# client_max_body_size    | No        | 1M         | Number + K/M/G suffix
# error_page              | No        | Err.html   | [code] [path]
# root                    | No        | /var/www/e | Valid filesystem path
# index                   | No	      | index.html | List of filenames
# allowed_methods         | No        | all        | GET, POST, DELETE
# autoindex               | No        | on         | on, off
# return                  | No        | N/A        | [code] [url]
# upload_store            | Yes**     | N/A        | Valid filesystem path
# cgi_pass                | Yes***    | N/A        | Path to CGI executable
# cgi_timeout             | Yes***    | 60         | 60-86400 (seconds)
# session_enable          | No****    | off        | on, off
# session_timeout         | No****    | 1800       | 60-86400 (seconds)
# session_name            | No****    | N/A        | [name]
# session_path            | No****    | N/A        | [path]
# connection_timeout      | No        | 60         | 1-3600 (seconds)
#
# ** Required only for upload locations
# *** Required only for CGI locations
# **** Required only if implementing session management (bonus)
#
##################################################################
# Directives Allowed in:
# (Realated to Overwrite/Override)(Global->{Server->{Location{}}})
##################################################################
#| **Directive**        | **Global** | **Server** | **Location** |
#|----------------------|:----------:|:----------:|:------------:|
#| listen               | -          | Yes        | -            |
#| host                 | -          | Yes        | -            |
#| server_name          | -          | Yes        | -            |
#| error_page           | Yes        | Yes        | Yes          |
#| client_max_body_size | Yes        | Yes        | Yes          |
#| root                 | Yes        | Yes        | Yes          |
#| index                | Yes        | Yes        | Yes          |
#| allowed_methods      | Yes        | Yes        | Yes          |
#| autoindex            | Yes        | Yes        | Yes          |
#| return               | -          | -          | Yes          |
#| upload_store         | Yes        | Yes        | Yes          |
#| cgi_pass             | -          | -          | Yes          |
#| cgi_timeout          | -          | -          | Yes          |
#| session_enable       | -          | Yes        | -            |
#| session_name         | -          | Yes        | -            |
#| session_path         | -          | Yes        | -            |
#| session_timeout      | -          | Yes        | Yes          |
##################################################################
